/*
	Videobox v1 - jQuery lightbox clone for displaying iframe videos
	Based on Slimbox 2.04 
		(c) 2007-2010 Christophe Beyls <http://www.digitalia.be>
		MIT-style license.
*/

(function vb(y){var F=y(window),v,h,f=-1,o,H,e,w,A,M,q,n=!window.XMLHttpRequest,s=[],l=document.documentElement,k={},t=new Image(),K=new Image(),I,c,i,C,G,d,D,L;y(function B(){y("body").append(y([I=y('<div id="vbOverlay" />')[0],c=y('<div id="vbCenter" />')[0],G=y('<div id="vbBottomContainer" />')[0]]).css("display","none"));i=y('<iframe id="vbVideo" frameborder="0" allowfullscreen="" />').appendTo(c)[0];C=y('<video controls="controls" autoplay="autoplay" name="media" id="vbVideo5" ></video>').appendTo(c)[0];d=y('<div id="vbBottom" />').appendTo(G).append([y('<a id="vbCloseLink" href="#" />').add(I).click(z)[0],D=y('<div id="vbCaption" />')[0],L=y('<div id="vbNumber" />')[0],y('<div style="clear: both;" />')[0]])[0]});y.videobox=function(P,O,N){v=y.extend({loop:false,overlayOpacity:0.8,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initialHeight:250,videoWidth:640,videoHeight:363,videoFadeDuration:400,captionAnimationDuration:400,counterText:"Video {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},N);if(typeof P=="string"){P=[[P,O]];O=0}A=F.scrollTop()+(F.height()/2);M=v.initialWidth;q=v.initialHeight;y(c).css({top:Math.max(0,A-(q/2)),width:M,height:q,marginLeft:-M/2}).show();w=n||(I.currentStyle&&(I.currentStyle.position!="fixed"));if(w){I.style.position="absolute"}y(I).css("opacity",v.overlayOpacity).fadeIn(v.overlayFadeDuration);a();g(1);h=P;v.loop=v.loop&&(h.length>1);return E(O)};y.fn.videobox=function(O,S,Q){S=S||function N(T){return[T.href,T.title]};Q=Q||function R(){return true};var P=this;return P.unbind("click").click(function R(){var V=this,X=0,W,T=0,U;W=y.grep(P,function(Z,Y){return Q.call(V,Z,Y)});for(U=W.length;T<U;++T){if(W[T]==V){X=T}W[T]=S(W[T],T)}return y.videobox(W,X,O)})};function a(){var O=F.scrollLeft(),N=F.width();y([c,G]).css("left",O+(N/2));if(w){y(I).css({left:O,top:F.scrollTop(),width:N,height:F.height()})}}function g(N){if(N){y("object").add(n?"select":"embed").each(function(P,Q){s[P]=[Q,Q.style.visibility];Q.style.visibility="hidden"})}else{y.each(s,function(P,Q){Q[0].style.visibility=Q[1]});s=[]}var O=N?"bind":"unbind";F[O]("scroll resize",a);y(document)[O]("keydown",m)}function m(P){var O=P.keyCode,N=y.inArray;return(N(O,v.closeKeys)>=0)?z():(N(O,v.nextKeys)>=0)?j():(N(O,v.previousKeys)>=0)?b():false}function b(){return E(H)}function j(){return E(e)}function E(N){if(N>=0){f=N;o=h[f][0];H=(f||(v.loop?h.length:0))-1;e=((f+1)%h.length)||(v.loop?0:-1);r();c.className="vbLoading";k=new Image();x();k.src=o;x}return false}function J(P,O,N){C.innerHTML='<source src="'+P+'.webm" type="video/webm"><source src="'+P+'.ogv" type="video/ogg"><source src="'+P+'.mp4" type="video/mp4"><source src="'+P+'.m4v" type="video/mp4">';C.setAttribute("poster",vb_site_root+"plugins/content/videobox/showthumb.php?img="+P.replace(vb_site_root,vb_site_base)+".ogv&width="+O+"&height="+N)}function p(O,P,N){C.innerHTML='<source src="'+O+'.oga" type="audio/ogg"><source src="'+O+'.mp3" type="audio/mpeg"><source src="'+O+'.webma" type="audio/webm"><source src="'+O+'.wav" type="audio/wav"><source src="'+O+'.m4a" type="audio/mp4">';C.setAttribute("poster",vb_site_root+"plugins/content/videobox/showthumb.php?img="+O.replace(vb_site_root,vb_site_base)+".oga&width="+P+"&height="+N)}function x(){c.className="";var N=h[f][2]||v.videoWidth;var V=h[f][3]||v.videoHeight;if(N>(F.width()-20)){N=F.width()-20}V=(V*N)/(h[f][2]||v.videoWidth);var R=true;var T=o.split("#t=")[0];switch(T.substr(-3)){case"mp4":y(C).css({visibility:"hidden",display:""});J(T.substr(0,T.length-4),N,V);break;case"ogv":y(C).css({visibility:"hidden",display:""});J(T.substr(0,T.length-4),N,V);break;case"ebm":y(C).css({visibility:"hidden",display:""});J(T.substr(0,T.length-5),N,V);break;case"m4v":y(C).css({visibility:"hidden",display:""});J(T.substr(0,T.length-4),N,V);break;case"oga":y(C).css({visibility:"hidden",display:""});p(T.substr(0,T.length-4),N,V);break;case"mp3":y(C).css({visibility:"hidden",display:""});p(T.substr(0,T.length-4),N,V);break;case"bma":y(C).css({visibility:"hidden",display:""});p(T.substr(0,T.length-6),N,V);break;case"wav":y(C).css({visibility:"hidden",display:""});p(T.substr(0,T.length-4),N,V);break;case"m4a":y(C).css({visibility:"hidden",display:""});p(T.substr(0,T.length-4),N,V);break;default:R=false;break}if(R){y(C).css({visibility:"hidden",display:""});y(C).width(N);y(C).height(V);var Q;var P=0;if(o.indexOf("#t=")!=-1){Q=o.split("#t=")[1];if(Q.indexOf("h")!=-1){P=P*60+parseInt(Q.split("h")[0]);Q=Q.split("h")[1]}if(Q.indexOf("m")!=-1){P=P*60+parseInt(Q.split("m")[0]);Q=Q.split("m")[1]}if(Q.indexOf("s")!=-1){P=P*60+parseInt(Q.split("s")[0])}}C.addEventListener("loadedmetadata",function U(W){C.currentTime=P},false)}else{y(i).css({visibility:"hidden",display:""});i.src=T;y(i).width(N);y(i).height(V)}y(D).html(h[f][1]||"");y(L).html((((h.length>1)&&v.counterText)||"").replace(/{x}/,f+1).replace(/{y}/,h.length));if(H>=0){t.src=h[H][0]}if(e>=0){K.src=h[e][0]}M=parseInt(N)+20;q=parseInt(V)+20;var S=Math.max(0,A-(q/2));y(c).animate({height:q,top:S,width:M,marginLeft:-M/2},v.resizeDuration,v.resizeEasing);y(c).queue(function O(){y(G).css({width:M,top:S+q,marginLeft:-M/2,visibility:"hidden",display:""});if(R){y(C).css({display:"none",visibility:"",opacity:""}).fadeIn(v.videoFadeDuration,u);C.play()}else{y(i).css({display:"none",visibility:"",opacity:""}).fadeIn(v.videoFadeDuration,u)}})}function u(){y(d).css("marginTop",-d.offsetHeight).animate({marginTop:0},v.captionAnimationDuration);G.style.visibility=""}function r(){C.pause();c.removeChild(C);C=y('<video controls="controls" autoplay="autoplay" name="media" id="vbVideo5" ></video>').appendTo(c)[0];k.onload=null;k.src=t.src=K.src=o;y([c,i,C,d]).stop(true);y([i,C,G]).hide();i.src="";i.title=""}function z(){if(f>=0){r();f=H=e=-1;y(c).hide();y(I).stop().fadeOut(v.overlayFadeDuration,g)}return false}})(jQuery);
// AUTOLOAD CODE BLOCK (MAY BE CHANGED OR REMOVED)
	jQuery(function vb($) {
	$("a[rel^='videobox']").videobox({ /* Put custom options here */ }, function vbl(el) {
			return [el.href, el.getAttribute("title"), el.getAttribute("videowidth"), el.getAttribute("videoheight")];
	}, function vbl(el) {
	  return (this == el) || ((this.rel.length > 8) && (this.rel == el.rel));
	 });
	});